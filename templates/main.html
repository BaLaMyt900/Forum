<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    {% load static %}
    {% block extra_head %}{% endblock extra_head %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="{% static 'profile.js' %}"></script>
    <script src="{% static 'live_chat.js' %}" type="text/javascript"></script>
    {% block scripts %}
    {% endblock scripts %}
    <title>{% block title %}{% endblock title %}</title>
</head>
<body class="bg-body" data-bs-theme="dark">
<div class="px-4">
  <nav class="navbar navbar-expand-lg rounded-bottom-3 bg-body-secondary">
  <div class="container-fluid">
    <div class="navbar-brand">Forum</div>
    <div class="nav-item"><a class="nav-link active" href="/">Главная</a></div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapse" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Переключатель навигации">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapse">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="/announce/new/">Создать объявление</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Выпадающий список
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Действие</a></li>
            <li><a class="dropdown-item" href="#">Другое действие</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Что-то еще здесь</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled">Отключенная</a>
        </li>
      </ul>
      <form class="d-flex" role="search">{% csrf_token %}
        <input class="form-control me-2" type="search" placeholder="Поиск" aria-label="Поиск">
        <button class="btn btn-outline-success" type="submit">Поиск</button>
      </form>
    </div>
  </div>
</nav>
</div>
<div class="d-flex align-content-stretch flex-wrap mb-3 p-2">
  <div class="p-2 me-auto" style="min-width: 300px">
    <div class="card flex-nowrap">
      <div class="card-header  text-body-emphasis">Чат</div>
      <div class="card-body p-0">
        <div class="card-text bg-body-tertiary">
          <div id="chatbox" class="d-flex flex-column rounded shadow overflow-y-auto py-2" style="height: 610px">
            <div class="spinner-border m-auto" id="chat_spinner" role="status">
              <span class="visually-hidden">Загрузка...</span>
            </div>
          </div>
          <div>
            <form class="form-control d-flex border-0 bg-body-tertiary" id="new_message">
              <input class="form-control" name="text" id="new_message_text" type="text">
              <button class="btn btn-outline-primary w-40 h-50 mx-1 bg-body" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                  <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    </div>
  <div class="p-2 flex-grow-1 flex-wrap w-50" style="min-width: 600px">{% block body %}{% endblock body %}</div>
  <div class="p-2" style="width: 400px">
    <div class="card flex-nowrap">
      <div class="card-header">Личный кабинет</div>
      <div class="card-body bg-body-tertiary" id="login_window">
        {% if not request.user.is_authenticated %}
          <form class="form-control bg-body-tertiary" id="login_form">
          <label for="login_email">Логин или E-mail адрес</label>
          <input class="form-control" id="login_email" name="login" type="text" required>
          <div class="invalid-feedback" id="login_errors"></div>
          <label for="password">Пароль</label>
          <input class="form-control" id="password" name="password" type="password" required>
          <div class="form-check">
            <input class="form-check-input" id="remember" name="remember" type="checkbox">
            <label class="form-check-label" for="remember">Запомнить меня</label>
          </div>
          <button class="btn btn-outline-primary my-2" style="width: 223px" type="submit">Авторизация</button>
            <a class="btn btn-outline-primary" href="/accounts/google/login/?process=login">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-google" viewBox="0 0 16 16">
                      <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"/>
                    </svg>
                </a>
          <h6>Еще нет аккаунта? <a href="{% url 'account_signup' %}">Регистрация</a></h6>
          <div class="alert alert-danger d-none" id="errors" role="alert"></div>
        </form>
       {% else %}
          <div class="card">
          <div class="card-header bg-body-tertiary">Здравствуй {{ request.user.username }}!</div>
{#              TODO: Доделать модуль профиля#}
          <div class="card-body bg-body-tertiary">
              <script type="text/javascript">if ({{ request.user.is_authenticated }}) {Getprofile({{ request.user.pk }})}</script>
            <div class="d-flex flex-row mb-3 btn-group bg-body" role="group">
              <button class="btn btn-outline-primary btn-sm" id="profile_btn">Профиль<span class="badge bg-primary rounded-pill">14</span></button>
              <button class="btn btn-outline-primary btn-sm" id="announce_btn">Объявления<span class="badge bg-primary rounded-pill">0</span></button>
              <button class="btn btn-outline-primary btn-sm" id="reply_btn">Отзывы<span class="badge bg-primary rounded-pill">14</span></button>
            </div>
            <div class="d-none" id="profile_content"></div>
            <div class="d-none" id="announce_content"></div>
            <div class="d-none" id="reply_content"></div>
          </div>
          <div class="card-footer d-grid gap-2 bg-body-tertiary">
            <button class="btn btn-outline-danger" id="logout_form">Выход</button>
            <button onclick="return Getprofile({{ request.user.pk }})">Обновить</button>
          </div>
          </div>
       {% endif %}
      </div>

    </div>
  </div>
  </div>
</body>
</html>